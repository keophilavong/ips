<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫µ‡ªà‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ‡∫™‡∫ª‡ªà‡∫á‡∫°‡∫≤ - Admin</title>
    <link rel="icon" type="image/png" href="../assets/images/edu.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin.css">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: var(--spacing-3xl) auto;
            padding: var(--spacing-xl);
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }
        
        .category-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-md);
        }
        
        .category-tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--bg-secondary);
            border: none;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .category-tab:hover {
            background: var(--bg-tertiary);
            color: var(--primary-color);
        }
        
        .category-tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .category-section {
            display: none;
            margin-bottom: var(--spacing-2xl);
        }
        
        .category-section.active {
            display: block;
        }
        
        .category-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e3a8a 100%);
            color: white;
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-lg);
        }
        
        .category-header h3 {
            margin: 0;
            font-size: 1.5rem;
            margin-bottom: var(--spacing-xs);
        }
        
        .category-count {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .submissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-lg);
        }
        
        .submission-card {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .submission-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            border-color: var(--primary-color);
        }
        
        .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }
        
        .submission-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }
        
        .submission-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .submission-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .submission-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .submission-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            margin-top: auto;
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }
        
        .btn-action {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .btn-view {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-view:hover {
            background: #1e3a8a;
        }
        
        .btn-download {
            background: #10b981;
            color: white;
        }
        
        .btn-download:hover {
            background: #059669;
        }
        
        .btn-link {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-link:hover {
            background: #7c3aed;
        }
        
        .empty-state {
            text-align: center;
            padding: var(--spacing-3xl);
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            border: 2px dashed var(--border-color);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }
        
        .loading {
            text-align: center;
            padding: var(--spacing-3xl);
            color: var(--text-secondary);
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .stat-card {
            background: white;
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: var(--spacing-md);
                padding-top: calc(var(--spacing-lg) + 120px);
            }
            
            .submissions-grid {
                grid-template-columns: 1fr;
            }
            
            .category-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .category-tab {
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>

<div id="adminNavbar"></div>

<div class="admin-container">
    <div class="admin-header">
        <div>
            <h2>‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫µ‡ªà‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ‡∫™‡∫ª‡ªà‡∫á‡∫°‡∫≤</h2>
            <p style="margin-top: 0.5rem; color: var(--text-secondary);">‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô ‡ªÅ‡∫•‡∫∞ ‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ó‡∫µ‡ªà‡∫ú‡∫π‡ªâ‡ªÉ‡∫ä‡ªâ‡∫™‡∫ª‡ªà‡∫á‡∫°‡∫≤‡∫à‡∫≤‡∫Å‡∫û‡∫≠‡∫î‡∫ó‡∫≤‡∫ô</p>
        </div>
    </div>
    
    <!-- Stats Summary -->
    <div class="stats-summary" id="statsSummary">
        <div class="stat-card">
            <div class="stat-value" id="totalCount">0</div>
            <div class="stat-label">‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="teacherCollegeCount">0</div>
            <div class="stat-label">‡∫ß‡∫¥‡∫ó‡∫∞‡∫ç‡∫≤‡ªÑ‡∫•‡∫Ñ‡∫π</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="internalWorkerCount">0</div>
            <div class="stat-label">‡∫ú‡∫π‡ªâ‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å‡∫™‡∫∂‡∫Å‡∫™‡∫≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="districtCount">0</div>
            <div class="stat-label">‡ªÄ‡∫°‡∫∑‡∫≠‡∫á</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="provinceCount">0</div>
            <div class="stat-label">‡ªÅ‡∫Ç‡∫ß‡∫á</div>
        </div>
    </div>
    
    <!-- Category Tabs -->
    <div class="category-tabs" style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); flex-wrap: wrap; border-bottom: 2px solid var(--border-color);">
        <button class="category-tab active" data-category="teacher_college" onclick="switchCategory('teacher_college')">
            <span style="font-size: 1.2rem; margin-right: 0.5rem;">üè´</span>
            <span>‡∫ß‡∫¥‡∫ó‡∫∞‡∫ç‡∫≤‡ªÑ‡∫•‡∫Ñ‡∫π</span>
            <span class="tab-count" id="count-teacher_college" style="margin-left: 0.5rem; background: rgba(255, 255, 255, 0.2); padding: 0.125rem 0.5rem; border-radius: 12px; font-size: 0.85rem;">0</span>
        </button>
        <button class="category-tab" data-category="internal_worker" onclick="switchCategory('internal_worker')">
            <span style="font-size: 1.2rem; margin-right: 0.5rem;">üë®‚Äçüè´</span>
            <span>‡∫ú‡∫π‡ªâ‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ô‡∫¥‡ªÄ‡∫ó‡∫î‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô</span>
            <span class="tab-count" id="count-internal_worker" style="margin-left: 0.5rem; background: rgba(255, 255, 255, 0.2); padding: 0.125rem 0.5rem; border-radius: 12px; font-size: 0.85rem;">0</span>
        </button>
        <button class="category-tab" data-category="district" onclick="switchCategory('district')">
            <span style="font-size: 1.2rem; margin-right: 0.5rem;">üèõ</span>
            <span>‡∫´‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ó‡∫¥‡∫Å‡∫≤‡∫ô‡ªÄ‡∫°‡∫∑‡∫≠‡∫á</span>
            <span class="tab-count" id="count-district" style="margin-left: 0.5rem; background: rgba(255, 255, 255, 0.2); padding: 0.125rem 0.5rem; border-radius: 12px; font-size: 0.85rem;">0</span>
        </button>
        <button class="category-tab" data-category="province" onclick="switchCategory('province')">
            <span style="font-size: 1.2rem; margin-right: 0.5rem;">üó∫</span>
            <span>‡∫û‡∫∞‡ªÅ‡∫ô‡∫Å‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ó‡∫¥‡∫Å‡∫≤‡∫ô‡ªÅ‡∫Ç‡∫ß‡∫á</span>
            <span class="tab-count" id="count-province" style="margin-left: 0.5rem; background: rgba(255, 255, 255, 0.2); padding: 0.125rem 0.5rem; border-radius: 12px; font-size: 0.85rem;">0</span>
        </button>
    </div>
    
    <!-- Submissions Container -->
    <div id="submissionsContainer">
        <div class="loading">
            <div class="loading"></div>
            <p style="margin-top: 1rem;">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫º‡∫î‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô...</p>
        </div>
    </div>
</div>

<script>
// Load admin navbar
fetch('../components/admin-navbar.html')
    .then(res => res.text())
    .then(data => {
        document.getElementById('adminNavbar').innerHTML = data;
    });

// Check admin authentication
function checkAuth() {
    fetch('../backend/check-admin.php')
        .then(response => response.json())
        .then(data => {
            if (!data.is_admin) {
                window.location.href = '../login.html';
            }
        })
        .catch(() => {
            window.location.href = '../login.html';
        });
}

let allSubmissionsData = {};
let currentCategory = 'teacher_college';

// Load submissions - using same endpoint as dashboard
function loadSubmissions() {
    fetch('../backend/fetch-all-submissions-by-category.php')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                document.getElementById('submissionsContainer').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p style="font-size: 1.2rem; color: var(--text-secondary);">‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î: ${data.error}</p>
                    </div>
                `;
                return;
            }
            
            // Ensure data structure is correct
            if (!data || typeof data !== 'object') {
                console.error('Invalid data structure:', data);
                document.getElementById('submissionsContainer').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p style="font-size: 1.2rem; color: var(--text-secondary);">‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫ö‡ªç‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á</p>
                    </div>
                `;
                return;
            }
            
            allSubmissionsData = data;
            
            // Update counts
            updateStats();
            
            // Display current category
            displaySubmissions(currentCategory);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('submissionsContainer').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                    <p style="font-size: 1.2rem; color: var(--text-secondary);">‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÉ‡∫ô‡∫Å‡∫≤‡∫ô‡ªÇ‡∫´‡∫º‡∫î‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô</p>
                </div>
            `;
        });
}

// Update statistics
function updateStats() {
    if (!allSubmissionsData || Object.keys(allSubmissionsData).length === 0) {
        return;
    }
    
    const counts = {
        teacher_college: (allSubmissionsData.teacher_college || []).length,
        internal_worker: (allSubmissionsData.internal_worker || []).length,
        district: (allSubmissionsData.district || []).length,
        province: (allSubmissionsData.province || []).length
    };
    
    const total = counts.teacher_college + counts.internal_worker + counts.district + counts.province;
    
    if (document.getElementById('totalCount')) {
        document.getElementById('totalCount').textContent = total;
    }
    if (document.getElementById('teacherCollegeCount')) {
        document.getElementById('teacherCollegeCount').textContent = counts.teacher_college;
    }
    if (document.getElementById('internalWorkerCount')) {
        document.getElementById('internalWorkerCount').textContent = counts.internal_worker;
    }
    if (document.getElementById('districtCount')) {
        document.getElementById('districtCount').textContent = counts.district;
    }
    if (document.getElementById('provinceCount')) {
        document.getElementById('provinceCount').textContent = counts.province;
    }
    
    // Update tab counts if they exist
    if (document.getElementById('count-teacher_college')) {
        document.getElementById('count-teacher_college').textContent = counts.teacher_college;
    }
    if (document.getElementById('count-internal_worker')) {
        document.getElementById('count-internal_worker').textContent = counts.internal_worker;
    }
    if (document.getElementById('count-district')) {
        document.getElementById('count-district').textContent = counts.district;
    }
    if (document.getElementById('count-province')) {
        document.getElementById('count-province').textContent = counts.province;
    }
}

// Switch category (same as dashboard)
function switchCategory(category) {
    currentCategory = category;
    
    // Update active tab
    document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    const activeTab = document.querySelector(`[data-category="${category}"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // Display submissions for selected category
    displaySubmissions(category);
}

// Filter by category (for backward compatibility)
function filterByCategory(category) {
    switchCategory(category);
}

// Display submissions - same format as dashboard
function displaySubmissions(category) {
    const container = document.getElementById('submissionsContainer');
    
    // Check if data is loaded
    if (!allSubmissionsData || Object.keys(allSubmissionsData).length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: var(--spacing-2xl); color: var(--text-secondary);">
                <div class="loading"></div>
                <p style="margin-top: 0.5rem; font-size: 0.9rem;">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫º‡∫î‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô...</p>
            </div>
        `;
        return;
    }
    
    const submissions = allSubmissionsData[category] || [];
    
    if (submissions.length === 0) {
        container.innerHTML = `
            <div class="empty-state" style="text-align: center; padding: var(--spacing-2xl);">
                <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">üì≠</div>
                <p style="color: var(--text-secondary); font-size: 1rem; margin: 0;">‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫ô‡ªù‡∫ß‡∫î‡∫ô‡∫µ‡ªâ</p>
            </div>
        `;
        return;
    }
    
    const categoryLabels = {
        'teacher_college': 'üè´ ‡∫ß‡∫¥‡∫ó‡∫∞‡∫ç‡∫≤‡ªÑ‡∫•‡∫Ñ‡∫π',
        'internal_worker': 'üë®‚Äçüè´ ‡∫ú‡∫π‡ªâ‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ô‡∫¥‡ªÄ‡∫ó‡∫î‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô',
        'district': 'üèõ ‡∫´‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ó‡∫¥‡∫Å‡∫≤‡∫ô ‡ªÅ‡∫•‡∫∞ ‡∫Å‡∫¥‡∫•‡∫≤‡ªÄ‡∫°‡∫∑‡∫≠‡∫á',
        'province': 'üó∫ ‡∫û‡∫∞‡ªÅ‡∫ô‡∫Å‡∫™‡∫∂‡∫Å‡∫™‡∫≤‡∫ó‡∫¥‡∫Å‡∫≤‡∫ô ‡ªÅ‡∫•‡∫∞ ‡∫Å‡∫¥‡∫•‡∫≤‡ªÅ‡∫Ç‡∫ß‡∫á'
    };
    
    container.innerHTML = submissions.map(submission => {
        const hasDocument = submission.file_path || submission.file_url;
        const hasVideo = submission.link_url && (submission.link_url.includes('youtube.com') || submission.link_url.includes('youtu.be') || submission.link_url.includes('vimeo.com'));
        const hasLink = submission.link_url && !hasVideo;
        const statusClass = submission.is_active ? 'approved' : 'pending';
        const statusText = submission.is_active ? '‡∫≠‡∫∞‡∫ô‡∫∏‡∫°‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß' : '‡∫•‡ªç‡∫ñ‡ªâ‡∫≤‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö';
        
        // Determine submission type for category label
        const submissionType = submission.type || category;
        const typeLabel = categoryLabels[submissionType] || submissionType;
        
        return `
            <div class="submission-item" style="background: white; border-radius: 12px; padding: var(--spacing-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--border-color); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
                <div class="submission-header" style="display: flex; justify-content: space-between; align-items: flex-start; gap: var(--spacing-lg); flex-wrap: wrap;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                            <span class="badge" style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">${typeLabel}</span>
                            <span class="badge" style="background: ${submission.is_active ? '#d1fae5' : '#fef3c7'}; color: ${submission.is_active ? '#059669' : '#92400e'}; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">${statusText}</span>
                            <span style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem;">${submission.name || '-'}</span>
                        </div>
                        <div class="submission-title" style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">${submission.title || '‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫´‡∫ª‡∫ß‡∫Ç‡ªç‡ªâ'}</div>
                        ${submission.description ? `
                            <div class="submission-description" style="color: var(--text-secondary); margin-bottom: 0.5rem; line-height: 1.6;">
                                ${submission.description.length > 200 ? submission.description.substring(0, 200) + '...' : submission.description}
                            </div>
                        ` : ''}
                        <div class="submission-meta" style="display: flex; gap: 0.75rem; margin-top: 0.5rem; flex-wrap: wrap; font-size: 0.8rem; color: var(--text-light);">
                            ${hasDocument ? '<span>üìÑ ‡∫°‡∫µ‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô</span>' : ''}
                            ${hasVideo ? '<span>üé• ‡∫°‡∫µ‡∫ß‡∫¥‡∫î‡∫µ‡ªÇ‡∫≠</span>' : ''}
                            ${hasLink ? '<span>üîó ‡∫°‡∫µ‡∫•‡∫¥‡ªâ‡∫á</span>' : ''}
                            <span>üìÖ ${new Date(submission.created_at).toLocaleDateString('lo-LA', {year: 'numeric', month: 'short', day: 'numeric'})}</span>
                        </div>
                    </div>
                    <div class="submission-actions" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${hasDocument ? `
                            <button onclick="viewDocument('${submission.file_url || submission.file_path}', '${(submission.title || submission.name || 'Document').replace(/'/g, "\\'")}')" class="btn btn-small" style="background: #3b82f6; color: white; padding: 0.4rem 0.75rem; border-radius: 6px; font-size: 0.8rem; border: none; cursor: pointer;" title="‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô">
                                üëÅÔ∏è ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á
                            </button>
                            <a href="${submission.file_url || submission.file_path}" download="${(submission.title || submission.name || 'document').replace(/[^a-z0-9]/gi, '_')}" onclick="downloadDocument(event, '${submission.file_url || submission.file_path}', '${(submission.title || submission.name || 'document').replace(/[^a-z0-9]/gi, '_')}')" class="btn btn-small" style="background: #10b981; color: white; text-decoration: none; padding: 0.4rem 0.75rem; border-radius: 6px; font-size: 0.8rem;" title="‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫º‡∫î‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô">
                                ‚¨áÔ∏è ‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫º‡∫î
                            </a>
                        ` : ''}
                        ${hasLink ? `
                            <a href="${submission.link_url}" target="_blank" class="btn btn-small" style="background: #10b981; color: white; text-decoration: none; padding: 0.4rem 0.75rem; border-radius: 6px; font-size: 0.8rem;">
                                üîó ‡ªÄ‡∫õ‡∫µ‡∫î
                            </a>
                        ` : ''}
                        <button class="btn btn-small" onclick="editSubmission('${submissionType}', ${submission.id})" style="background: #f59e0b; color: white; padding: 0.4rem 0.75rem; border-radius: 6px; font-size: 0.8rem; border: none; cursor: pointer;">
                            ‚úèÔ∏è ‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç
                        </button>
                        <button class="btn btn-small" onclick="deleteSubmission('${submissionType}', ${submission.id}, '${(submission.name || submission.title || '').replace(/'/g, "\\'")}')" style="background: #dc2626; color: white; padding: 0.4rem 0.75rem; border-radius: 6px; font-size: 0.8rem; border: none; cursor: pointer;">
                            üóëÔ∏è ‡∫•‡∫∂‡∫ö
                        </button>
                        ${!submission.is_active ? `
                            <button class="btn btn-small btn-success" onclick="approveSubmission('${submissionType}', ${submission.id})" style="padding: 0.4rem 0.75rem; font-size: 0.8rem;">‚úÖ ‡∫≠‡∫∞‡∫ô‡∫∏‡∫°‡∫±‡∫î</button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// CRUD Functions - same as dashboard
function editSubmission(category, id) {
    // Redirect to appropriate management page
    const pages = {
        'teacher_college': 'manage-teacher-colleges.html',
        'internal_worker': 'manage-internal-workers.html',
        'district': 'manage-districts.html',
        'province': 'manage-provinces.html'
    };
    const page = pages[category];
    if (page) {
        window.location.href = page + '?edit=' + id;
    } else {
        alert('‡∫õ‡∫∞‡ªÄ‡∫û‡∫î‡∫ö‡ªç‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á');
    }
}

function deleteSubmission(category, id, name) {
    if (!confirm(`‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö "${name}"?\n\n‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫ô‡∫µ‡ªâ‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å‡ªÑ‡∫î‡ªâ!`)) {
        return;
    }
    
    const formData = new FormData();
    formData.append('id', id);
    
    // Map category to endpoint
    const endpoints = {
        'teacher_college': '../backend/delete-teacher-college.php',
        'internal_worker': '../backend/delete-internal-worker.php',
        'district': '../backend/delete-district.php',
        'province': '../backend/delete-province.php'
    };
    
    const endpoint = endpoints[category];
    if (!endpoint) {
        alert('‡∫õ‡∫∞‡ªÄ‡∫û‡∫î‡∫ö‡ªç‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á');
        return;
    }
    
    // Map category to ID field name
    const idFields = {
        'teacher_college': 'college_id',
        'internal_worker': 'worker_id',
        'district': 'district_id',
        'province': 'province_id'
    };
    
    formData.append(idFields[category], id);
    
    fetch(endpoint, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message || '‡∫•‡∫∂‡∫ö‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß');
            loadSubmissions();
            updateStats();
        } else {
            alert('‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î: ' + (data.error || '‡∫•‡∫∂‡∫ö‡∫ö‡ªç‡ªà‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î'));
        }
    })
    .catch(error => {
        alert('‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÉ‡∫ô‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö');
        console.error(error);
    });
}

function approveSubmission(category, id) {
    const formData = new FormData();
    formData.append('type', category);
    formData.append('id', id);
    formData.append('action', 'approve');
    
    fetch('../backend/approve-submission.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‡∫≠‡∫∞‡∫ô‡∫∏‡∫°‡∫±‡∫î‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß');
            loadSubmissions();
            updateStats();
        } else {
            alert('‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î: ' + (data.error || '‡∫≠‡∫∞‡∫ô‡∫∏‡∫°‡∫±‡∫î‡∫ö‡ªç‡ªà‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î'));
        }
    })
    .catch(error => {
        alert('‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÉ‡∫ô‡∫Å‡∫≤‡∫ô‡∫≠‡∫∞‡∫ô‡∫∏‡∫°‡∫±‡∫î');
        console.error(error);
    });
}

function viewDocument(fileUrl, title) {
    if (!fileUrl) {
        alert('‡∫ö‡ªç‡ªà‡∫°‡∫µ‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô');
        return;
    }
    // Open in new tab
    window.open(fileUrl, '_blank');
}

function downloadDocument(event, fileUrl, filename) {
    if (!fileUrl) {
        event.preventDefault();
        alert('‡∫ö‡ªç‡ªà‡∫°‡∫µ‡ªÄ‡∫≠‡∫Å‡∫∞‡∫™‡∫≤‡∫ô‡ªÉ‡∫´‡ªâ‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫º‡∫î');
        return;
    }
    // Let default download behavior work
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    loadSubmissions();
});
</script>
</body>
</html>

