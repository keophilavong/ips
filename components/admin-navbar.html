<nav class="admin-navbar">
    <div class="admin-navbar-container">
        <div class="admin-navbar-brand">
            <div class="admin-logo-wrapper">
                <img src="../assets/images/edu.png" alt="MOES Logo" class="admin-logo" onerror="this.style.display='none';">
            </div>
            <div class="admin-brand-text">
                <span class="admin-brand-main">เปเบเบเบเบงเบเบเบธเบกเบเบนเปเบเบนเปเบฅเบฅเบฐเบเบปเบ</span>
                <span class="admin-brand-sub">เบฅเบฐเบเบปเบเบฅเบฒเบเบเบฒเบเบเบนเปเปเบฎเบฑเบเบงเบฝเบเบชเบถเบเบชเบฒ</span>
            </div>
        </div>
        
        <div class="admin-navbar-menu">
            <a href="dashboard.html" class="admin-nav-link" data-page="dashboard">
                <span class="admin-nav-icon">๐</span>
                <span>เปเบเบเบเบงเบเบเบธเบก</span>
            </a>
            <a href="manage-activities.html" class="admin-nav-link" data-page="activities">
                <span class="admin-nav-icon">๐</span>
                <span>เบเบดเบเบเบฐเบเบณ</span>
            </a>
            <a href="view-reports.html" class="admin-nav-link" data-page="reports">
                <span class="admin-nav-icon">๐</span>
                <span>เปเบญเบเบฐเบชเบฒเบ</span>
            </a>
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-link" id="contentDropdownToggle">
                    <span class="admin-nav-icon">๐</span>
                    <span>เปเบเบทเปเบญเบซเบฒ</span>
                    <span style="margin-left: auto;">โผ</span>
                </a>
                <div class="admin-dropdown-menu">
                    <a href="manage-teacher-colleges.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐ซ</span> เบงเบดเบเบฐเบเบฒเปเบฅเบเบน
                    </a>
                    <a href="manage-internal-workers.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐จโ๐ซ</span> เบเบนเปเปเบฎเบฑเบเบงเบฝเบเบชเบถเบเบชเบฒเบเบดเปเบเบเบเบฒเบเปเบ
                    </a>
                    <a href="manage-districts.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐</span> เปเบกเบทเบญเบ
                    </a>
                    <a href="manage-provinces.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐บ</span> เปเบเบงเบ
                    </a>
                    <a href="manage-cpd.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐</span> เปเบเบทเปเบญเบซเบฒ CPD
                    </a>
                    <a href="manage-menu-items.html" class="admin-dropdown-item">
                        <span style="margin-right: 10px;">๐</span> เบฅเบฒเบเบเบฒเบเปเบกเบเบน
                    </a>
                </div>
            </div>
            <a href="manage-users.html" class="admin-nav-link" data-page="users">
                <span class="admin-nav-icon">๐ฅ</span>
                <span>เบเบนเปเปเบเป</span>
            </a>
            <a href="system-settings.html" class="admin-nav-link" data-page="settings">
                <span class="admin-nav-icon">โ๏ธ</span>
                <span>เบเบฒเบเบเบฑเปเบเบเปเบฒ</span>
            </a>
        </div>
        
        <div class="admin-navbar-user">
            <a href="../backend/logout.php" class="admin-logout-btn" id="adminLogoutBtn" onclick="return handleLogoutClick(event);">เบญเบญเบเบเบฒเบเบฅเบฐเบเบปเบ</a>
        </div>
    </div>
</nav>

<style>
/* Admin navbar styles are now in admin.css for better organization */
</style>

<script>
// Initialize admin navbar functionality
function initAdminNavbar() {
    const currentPage = window.location.pathname.split('/').pop() || 'dashboard.html';
    const navLinks = document.querySelectorAll('.admin-nav-link[data-page]');
    
    navLinks.forEach(link => {
        const page = link.getAttribute('data-page');
        if (currentPage.includes(page) || (page === 'dashboard' && currentPage === 'dashboard.html')) {
            link.classList.add('active');
        }
    });
    
    
    // Logout button handler - simplified
    const logoutBtn = document.getElementById('adminLogoutBtn');
    if (logoutBtn) {
        // Ensure onclick is set
        logoutBtn.setAttribute('onclick', 'return handleLogoutClick(event);');
        
        // Also add event listener as backup
        logoutBtn.addEventListener('click', function(e) {
            return handleLogoutClick(e);
        }, true); // Use capture phase
    }
    
    // Dropdown toggle handler - improved
    setTimeout(function() {
        const dropdownToggle = document.getElementById('contentDropdownToggle');
        const dropdown = dropdownToggle ? dropdownToggle.closest('.admin-nav-dropdown') : null;
        
        if (dropdownToggle && dropdown) {
            // Add click event to toggle dropdown
            dropdownToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const isActive = dropdown.classList.contains('active');
                
                // Close all other dropdowns
                document.querySelectorAll('.admin-nav-dropdown').forEach(d => {
                    if (d !== dropdown) {
                        d.classList.remove('active');
                    }
                });
                
                // Toggle current dropdown
                dropdown.classList.toggle('active');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (dropdown && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
        }
    }, 100);
}

// Run when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAdminNavbar);
} else {
    initAdminNavbar();
}

// Also run after a short delay to ensure navbar is loaded
setTimeout(initAdminNavbar, 200);

// Simple click handler for logout link
function handleLogoutClick(event) {
    if (!confirm('เบเปเบฒเบเปเบเปเปเบเบเปเปเบงเปเบฒเบเปเบญเบเบเบฒเบเบญเบญเบเบเบฒเบเบฅเบฐเบเบปเบ?')) {
        event.preventDefault();
        return false;
    }
    
    const logoutBtn = document.getElementById('adminLogoutBtn');
    if (logoutBtn) {
        logoutBtn.textContent = 'เบเบณเบฅเบฑเบเบญเบญเบเบเบฒเบเบฅเบฐเบเบปเบ...';
        logoutBtn.style.pointerEvents = 'none';
    }
    
    // Let the link navigate naturally, or use fetch
    event.preventDefault();
    
    fetch('../backend/logout.php', {
        method: 'POST',
        credentials: 'same-origin'
    })
    .then(() => {
        window.location.href = '../login.html';
    })
    .catch(() => {
        window.location.href = '../login.html';
    });
    
    return false;
}

// Global logout handler function (works even if event listeners fail)
function handleLogout(event) {
    return handleLogoutClick(event);
}

// Additional logout button handler as fallback - ensure it works
document.addEventListener('DOMContentLoaded', function() {
    function setupLogout() {
        const logoutBtn = document.getElementById('adminLogoutBtn');
        if (logoutBtn) {
            // Ensure onclick handler is present
            logoutBtn.setAttribute('onclick', 'return handleLogoutClick(event);');
            
            // Add event listener as additional backup
            if (!logoutBtn.hasAttribute('data-listener-attached')) {
                logoutBtn.setAttribute('data-listener-attached', 'true');
                logoutBtn.addEventListener('click', function(e) {
                    return handleLogoutClick(e);
                }, true);
            }
        }
    }
    
    // Try immediately
    setupLogout();
    
    // Also try after delay
    setTimeout(setupLogout, 100);
    setTimeout(setupLogout, 500);
});
</script>

